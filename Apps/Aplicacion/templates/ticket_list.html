{% extends 'base.html' %}
{% load static %}
{% block title %}Listado de Tickets{% endblock title %} 

{% block body %}
<header>
    <nav class="container">
        <ul>
            <li><img class="logo" src="{% static 'imagen/fundabit_logo_g428.svg' %}" alt="Logo Fundabit"></li>
        </ul>
        <ul>
            {% if request.user.is_superuser %}
             <li>
                <a href="{% url 'Administracion' %}">Administrar</a>
            </li>
            {% endif %}
            <li>
                <a href="{% url 'ticket_list' %}">Tickets</a></li>
            {% if user.is_authenticated %}
            <li class="profile-li">
                <a href="{% url 'perfil_usuario' %}" class="profile-button">
                    {{ user.first_name|upper|slice:":1" }}
                </a>
            </li>
            {% else %}
            <li><a class="login-button" href="{% url 'login_view' %}">Iniciar Sesión</a></li>
            {% endif %}
        </ul>
    </nav>
</header>
<main class="container"></main>

{% if not user.is_authenticated %}
<p>Inicia sesión para continuar</p>
{% else %}
    <div class="centrar">
        <ul>
            {% for ticket in tickets %}
                <li class="ticket {% if ticket.fecha_cierre %}resuelto{% else %}no-resuelto{% endif %}">
                    <div>
                        <strong>Título:</strong> 
                        <a href="{% url 'ticket_detalle' ticket.id %}">{{ ticket.titulo }}</a>
                        <span>(ID: {{ ticket.id }})</span> 
                    </div>
                    
                    <div><strong>Fecha de Creación:</strong> {{ ticket.fecha_creacion|date:"d-m-Y" }}</div>
                    <div><strong>Presentado por:</strong> {{ ticket.presentado_por.nombre }} {{ ticket.presentado_por.apellido }}</div>
                    <div><strong>Presentado en:</strong> {{ ticket.presentado_en.nombre }}</div>
                    <div><strong>Resuelto por:</strong> {{ ticket.resuelto_por.username|default:"No resuelto" }}</div>
                    <div><strong>Comentarios:</strong> {{ ticket.comentarios.count }}</div> 
                </li>
                <li class="mensaje">
                    No hay tickets disponibles.
                </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

</main>

<div class="fixed-button">
    <a class="button" href="{% url 'ticket_create' %}">Crear Ticket</a>
</div>

{% endblock body %}
